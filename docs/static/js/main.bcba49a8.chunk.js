(this.webpackJsonpcs7580_messageboard=this.webpackJsonpcs7580_messageboard||[]).push([[0],{38:function(e,t,n){},39:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n.n(r),a=n(17),s=n.n(a),o=n(4),i=(n(37),n(42),n(15)),l=n(25),u="LOGIN_SUCCESS",d="INVALID_LOGIN",j="LOGIN_NETWORK_ERROR",b="LOGOUT",h="READ_THREADS",f="ADD_REPLY",m="VIEW_LIST",p="VIEW_SINGLE",O="VIEW_LOGIN",g="logged in",v="logged out",x="invalid login",y="network error",N="thread_list",w="single_thread",S="login",C={loginState:v},I=n(3),T={view:N,singleId:"",searchTags:[]},k={},L=n(10),D=[],R=Object(i.c)({loginReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return{loginState:g};case d:return{loginState:x};case j:return{loginState:y};case b:return{loginState:v};default:return e}},viewReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return Object(I.a)(Object(I.a)({},e),{},{view:N,singleId:"",searchTags:t.payload.searchTags});case p:return Object(I.a)(Object(I.a)({},e),{},{view:w,singleId:t.payload.threadId});case O:return Object(I.a)(Object(I.a)({},e),{},{view:S});default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return t.payload.user;case b:return k;default:return e}},threads:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:return Object(L.a)(t.payload.threads);case f:var n=[].concat(Object(L.a)(e.filter((function(e){return t.payload.threadId===e.id}))[0].replies),[t.payload.reply]),r=e.map((function(e){return e.id===t.payload.threadId?Object(I.a)(Object(I.a)({},e),{},{replies:n}):e}));return r;default:return e}},testState:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return t.type,e}}),F=Object(i.d)(R,Object(i.a)(l.a)),A=(n(38),n(39),n(11)),E=function(e){return{type:m,payload:{searchTags:e}}},_=function(){return{type:O}},U=n(1),P=function(e){var t=Object(o.b)(),n=function(e){var n,r=e.split(" ").map((function(e,n){return"#"===e.charAt(0)?Object(U.jsx)("a",{className:"tag",href:"#",value:e,onClick:function(){return t(E(e))},children:e},n):e})),c=[],a=Object(A.a)(r);try{for(a.s();!(n=a.n()).done;){var s=n.value;c.push(s),c.push(" ")}}catch(o){a.e(o)}finally{a.f()}return c.pop(),c};return Object(U.jsxs)("div",{className:"list-group-item","data-testid":"thread-snippet-test",children:[Object(U.jsx)("a",{className:"thread-title",href:"#",onClick:function(){return t((n=e.thread.id,{type:p,payload:{threadId:n}}));var n},children:Object(U.jsx)("h3",{children:e.thread.title})}),Object(U.jsxs)("p",{children:["Author: ",e.thread.author]}),Object(U.jsx)("p",{children:e.thread.body.length>200?n(e.thread.body.substring(0,200)+"..."):n(e.thread.body)}),Object(U.jsxs)("p",{children:["Posted: ",function(e){var t=new Date(e);return t.toLocaleDateString("en-US",{year:"2-digit",month:"long",day:"numeric"})+" at "+t.toLocaleTimeString("en-US",{timeZone:"America/New_York",hourCycle:"h24"})}(e.thread.timestamp)]})]})},B=function(){var e=Object(o.c)((function(e){return e.threads}));return Object(U.jsx)(U.Fragment,{children:e.length>0?e.map((function(e,t){return Object(U.jsx)(P,{thread:e},t)})):Object(U.jsx)("p",{children:"No threads to display."})})},G=function(e){var t=Object(o.b)();return Object(U.jsxs)("div",{className:"list-group-item",children:[Object(U.jsxs)("p",{children:["Author: ",e.reply.author]}),Object(U.jsx)("p",{children:function(e){var n,r=e.split(" ").map((function(e){return"#"===e.charAt(0)?Object(U.jsx)("a",{className:"tag",href:"#",onClick:function(){return t(E(e))},children:e}):e})),c=[],a=Object(A.a)(r);try{for(a.s();!(n=a.n()).done;){var s=n.value;c.push(s),c.push(" ")}}catch(o){a.e(o)}finally{a.f()}return c.pop(),c}(e.reply.body)}),Object(U.jsxs)("p",{children:["Replied: ",function(e){var t=new Date(e);return t.toLocaleDateString("en-US",{year:"2-digit",month:"long",day:"numeric"})+" at "+t.toLocaleTimeString("en-US",{timeZone:"America/New_York",hourCycle:"h24"})}(e.reply.timestamp)]})]})},W=n(8),K=n(22);n(44);K.a.initializeApp({apiKey:"AIzaSyDDYfwcl9nuD6NrGgToNatyDgcROdZb54w",authDomain:"cs7580-a5-message-board.firebaseapp.com",projectId:"cs7580-a5-message-board",storageBucket:"cs7580-a5-message-board.appspot.com",messagingSenderId:"575151180871",appId:"1:575151180871:web:d7469bf4bfca3e2c927562"});var V=K.a,Y=V.firestore(),Z=function(e){return{type:h,payload:{threads:e}}},z=function(){return function(e){Y.collection("threads").get().then((function(t){var n=[];t.forEach((function(e){n.push(Object(I.a)({id:e.id},e.data()))})),n.sort((function(e,t){return e.timestamp-t.timestamp})),e(Z(n))})).catch((function(e){console.log("Server error",e)}))}},J=function(e){return function(t){Y.collection("threads").where("tags","array-contains-any",e).get().then((function(e){var n=[];e.forEach((function(e){n.push(Object(I.a)({id:e.id},e.data()))})),n.sort((function(e,t){return e.timestamp-t.timestamp})),t(Z(n))})).catch((function(e){console.log("Server error",e)}))}},q=function(e,t){return function(n){Y.collection("threads").doc(e).update({replies:V.firestore.FieldValue.arrayUnion(t)}).then((function(){n(function(e,t){return{type:f,payload:{threadId:e,reply:t}}}(e,t))})).catch((function(e){console.log("Could not add the reply")}))}},H=function(e){var t=Object(r.useState)(""),n=Object(W.a)(t,2),c=n[0],a=n[1],s=Object(o.c)((function(e){return e.user})),i=Object(o.b)();return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)("div",{className:"form-floating mb-3",children:[Object(U.jsx)("textarea",{className:"form-control",placeholder:"Reply",id:"newReplyBody",value:c,onChange:function(e){return a(e.target.value)}}),Object(U.jsx)("label",{htmlFor:"newReplyBody",children:"Reply content"})]}),Object(U.jsx)("button",{className:"btn btn-success",onClick:function(){return function(){var t={author:s.id,body:c,timestamp:Date.now()};i(q(e.threadId,t)),a("")}()},disabled:""===c,children:"Post"})]})},M=function(){var e=Object(o.b)(),t=Object(o.c)((function(e){return e.loginReducer.loginState})),n=Object(o.c)((function(e){return e.threads})),r=Object(o.c)((function(e){return e.viewReducer.singleId})),c=function(e){var t=new Date(e);return t.toLocaleDateString("en-US",{year:"2-digit",month:"long",day:"numeric"})+" at "+t.toLocaleTimeString("en-US",{timeZone:"America/New_York",hourCycle:"h24"})},a=function(t){var n,r=t.split(" ").map((function(t,n){return"#"===t.charAt(0)?Object(U.jsx)("a",{className:"tag",href:"#",value:t,onClick:function(){return e(E(t))},children:t},n):t})),c=[],a=Object(A.a)(r);try{for(a.s();!(n=a.n()).done;){var s=n.value;c.push(s),c.push(" ")}}catch(o){a.e(o)}finally{a.f()}return c.pop(),c};return Object(U.jsx)(U.Fragment,{children:n.filter((function(e){return r===e.id})).map((function(n,r){return Object(U.jsx)("div",{className:"card card-body",children:Object(U.jsxs)("div",{className:"list-group-flush",children:[Object(U.jsxs)("div",{className:"list-group-item",children:[Object(U.jsxs)("div",{className:"thread-title-box",children:[Object(U.jsx)("h3",{children:n.title}),Object(U.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(){return e(E(""))}})]}),Object(U.jsxs)("p",{children:["Author: ",n.author]}),Object(U.jsx)("p",{children:a(n.body)}),Object(U.jsxs)("p",{children:["Posted: ",c(n.timestamp)]})]}),Object(U.jsx)("div",{className:"list-group-item",children:t===g?Object(U.jsx)(H,{threadId:n.id}):Object(U.jsx)(U.Fragment,{children:Object(U.jsxs)("p",{children:["Want to join the conversation? ",Object(U.jsx)("button",{className:"btn btn-success",onClick:function(){return e(_())},children:"Log In"})]})})}),n.replies.map((function(e,t){return Object(U.jsx)(G,{reply:e},t)}))]})},r)}))})},X=V.firestore(),Q=function(e,t){return function(n){X.collection("users").where("username","==",e).where("password","==",t).get().then((function(e){if(1===e.size){var t={id:e.docs[0].id};n(function(e){return{type:u,payload:{user:e}}}(t)),n(E([]))}else console.log("Login failure"),n({type:d})})).catch((function(e){console.log("Login error",e),n({type:j})}))}},$=function(){var e=Object(r.useState)(""),t=Object(W.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(""),s=Object(W.a)(a,2),i=s[0],l=s[1],u=Object(r.useState)([]),d=Object(W.a)(u,2),j=d[0],b=d[1],h=Object(o.c)((function(e){return e.user})),f=Object(o.b)();Object(r.useEffect)((function(){var e=i.split(" ").filter((function(e){return"#"===e.charAt(0)}));b(e)}),[i]);var m=function(){var e={author:h.id,body:i,replies:[],tags:j,timestamp:Date.now(),title:n};f(function(e){var t=F.getState().threads;return function(n){Y.collection("threads").add(e).then((function(r){var c=t.concat([Object(I.a)(Object(I.a)({},e),{},{id:r.id})]);c.sort((function(e,t){return e.timestamp-t.timestamp})),n(Z(c))})).catch((function(e){return console.log(e)}))}}(e)),c(""),l(""),b([])};return Object(U.jsxs)("div",{className:"list-group-item",children:[Object(U.jsx)("button",{className:"btn btn-primary start-thread-open",type:"button","data-bs-toggle":"collapse","data-bs-target":"#startThreadCollapse","aria-expanded":"false","aria-controls":"startThreadCollapse",children:"Start a new thread"}),Object(U.jsxs)("div",{className:"collapse mt-3",id:"startThreadCollapse",children:[Object(U.jsxs)("div",{className:"form-floating mb-3",children:[Object(U.jsx)("input",{type:"text",className:"form-control",id:"newThreadTitle",placeholder:"Thread title",value:n,onChange:function(e){return c(e.target.value)}}),Object(U.jsx)("label",{htmlFor:"newThreadTitle",children:"Thread title"})]}),Object(U.jsxs)("div",{className:"form-floating mb-3",children:[Object(U.jsx)("textarea",{className:"form-control",placeholder:"Thread content",id:"newThreadBody",value:i,onChange:function(e){return l(e.target.value)},rows:"5"}),Object(U.jsx)("label",{htmlFor:"newThreadBody",children:"Thread content"})]}),Object(U.jsx)("button",{className:"btn btn-success start-thread-submit",onClick:function(){return m()},disabled:""===n||""===i,children:"Post"})]})]})},ee=function(){var e=Object(o.c)((function(e){return e.viewReducer.searchTags})),t=Object(r.useState)(""),n=Object(W.a)(t,2),c=n[0],a=n[1];console.log("Search now equals",c);var s=Object(r.useState)([]),i=Object(W.a)(s,2),l=i[0],u=i[1],d=Object(o.b)();Object(r.useEffect)((function(){d(z())}),[d]),Object(r.useEffect)((function(){if(""!==c){var e=c.split(" ").map((function(e){return"#"!==e.charAt(0)?"#"+e:e}));u(e),console.log("Set new tags",e)}}),[c]),Object(r.useEffect)((function(){var t,n="",r=Object(A.a)(e);try{for(r.s();!(t=r.n()).done;){n=n+t.value+""}}catch(s){r.e(s)}finally{r.f()}if(""!==n){a(n);var c=n.split(" ").map((function(e){return"#"!==e.charAt(0)?"#"+e:e}));u(c),d(J(c))}}),[e,d]);var j=function(){""===c?b():d(J(l))},b=function(){a(""),d(z())};return Object(U.jsx)(U.Fragment,{children:Object(U.jsxs)("div",{className:"form-floating input-group mb-3",children:[Object(U.jsx)("input",{type:"text",className:"form-control",placeholder:"Search by tags",id:"tagSearch",value:c,onChange:function(e){return a(e.target.value)},onKeyUp:function(e){var t;13===(t=e).keyCode&&(t.preventDefault(),j())}}),Object(U.jsx)("label",{htmlFor:"tagSearch",children:"Search threads by tag"}),""!==c?Object(U.jsx)("button",{className:"btn btn-outline-secondary",onClick:function(){return b()},children:"X"}):Object(U.jsx)(U.Fragment,{}),Object(U.jsx)("button",{className:"btn btn-outline-success",onClick:function(){return j()},children:"Search"})]})})},te=!1,ne=function(){var e=Object(r.useState)(""),t=Object(W.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(""),s=Object(W.a)(a,2),i=s[0],l=s[1],u=Object(o.c)((function(e){return e.loginReducer.loginState})),d=Object(o.b)(),j=function(){d(Q(n,i)),h()},b=function(e){13===e.keyCode&&(e.preventDefault(),j())},h=function(){te=!1,c(""),l("")};return Object(U.jsxs)("div",{className:"container",children:[!te&&u===x&&Object(U.jsx)("div",{className:"alert alert-danger",children:"Invalid username / password! Please try again."}),!te&&u===y&&Object(U.jsx)("div",{className:"alert alert-danger",children:"Unable to connect to the server. Please check your internet connection."}),Object(U.jsxs)("div",{className:"row my-4 add-form",children:[Object(U.jsx)("div",{className:"col-12 col-sm-2",children:Object(U.jsx)("label",{htmlFor:"username",className:"form-label",children:"Username:"})}),Object(U.jsx)("div",{className:"col",children:Object(U.jsx)("input",{type:"text",id:"username",name:"username",className:"form-control",value:n,onChange:function(e){te=!0,c(e.target.value)},onKeyUp:function(e){return b(e)}})})]}),Object(U.jsxs)("div",{className:"row my-4 add-form",children:[Object(U.jsx)("div",{className:"col-12 col-sm-2",children:Object(U.jsx)("label",{htmlFor:"password",className:"form-label",children:"Password:"})}),Object(U.jsx)("div",{className:"col",children:Object(U.jsx)("input",{type:"password",id:"password",name:"password",className:"form-control",value:i,onChange:function(e){te=!0,l(e.target.value)},onKeyUp:function(e){return b(e)}})})]}),Object(U.jsx)("div",{className:"row",children:Object(U.jsx)("div",{className:"col",children:Object(U.jsx)("button",{className:"btn btn-secondary float-end login-button",onClick:j,children:"Log in"})})})]})};var re=function(){var e=Object(o.b)(),t=Object(o.c)((function(e){return e.loginReducer.loginState})),n=Object(o.c)((function(e){return e.viewReducer.view}));return Object(U.jsx)("div",{className:"App container",children:n===S?Object(U.jsx)(ne,{}):Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)("nav",{className:"navbar",children:t!==g?Object(U.jsx)("button",{className:"btn btn-success heading-button",onClick:function(){return e(_())},children:"Log In"}):Object(U.jsx)("button",{className:"btn btn-secondary heading-button",onClick:function(){return e({type:b})},children:"Log Out"})}),n===N?Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(ee,{}),Object(U.jsxs)("div",{className:"card card-body list-group-flush",children:[t===g?Object(U.jsx)($,{}):Object(U.jsx)("div",{className:"list-group-item",children:Object(U.jsxs)("p",{children:["Want to join the conversation? ",Object(U.jsx)("button",{className:"btn btn-success",onClick:function(){return e(_())},children:"Log In"})]})}),Object(U.jsx)(B,{})]})]}):Object(U.jsx)(U.Fragment,{children:n===w?Object(U.jsx)(M,{}):Object(U.jsxs)("p",{children:["Error: view set to ",n]})})]})})},ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,47)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))};s.a.render(Object(U.jsx)(c.a.StrictMode,{children:Object(U.jsx)(o.a,{store:F,children:Object(U.jsx)(re,{})})}),document.getElementById("root")),ce()}},[[43,1,2]]]);
//# sourceMappingURL=main.bcba49a8.chunk.js.map